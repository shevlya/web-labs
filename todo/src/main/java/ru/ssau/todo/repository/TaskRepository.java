package ru.ssau.todo.repository;

import ru.ssau.todo.entity.Task;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;

/**
 * Интерфейс репозитория для управления жизненным циклом сущностей {@link Task}.
 * Обеспечивает абстракцию над механизмом хранения данных.
 */
public interface TaskRepository {

    /**
     * Сохраняет новую задачу в хранилище.
     * При сохранении репозиторий обязан присвоить задаче уникальный идентификатор.
     *
     * @param task объект задачи для сохранения (без ID).
     * @return сохраненный экземпляр задачи с назначенным идентификатором.
     * @throws IllegalArgumentException если передана пустая задача (null).
     */
    Task create(Task task);

    /**
     * Выполняет поиск задачи по её уникальному идентификатору.
     *
     * @param id уникальный идентификатор задачи.
     * @return {@link Optional}, содержащий найденную задачу,
     * или пустой Optional, если задача с таким ID не найдена.
     */
    Optional<Task> findById(long id);

    /**
     * Возвращает список всех задач конкретного пользователя, созданных в указанном временном диапазоне.
     *
     * @param from   начальная граница даты создания (включительно).
     * @param to     конечная граница даты создания (включительно).
     * @param userId уникальный идентификатор пользователя-владельца.
     * @return список задач, соответствующих критериям поиска. Если ничего не найдено, возвращается пустой список.
     */
    List<Task> findAll(LocalDateTime from, LocalDateTime to, long userId);

    /**
     * Обновляет данные существующей задачи в хранилище.
     * Поиск записи для обновления осуществляется по полю ID, содержащемуся в объекте task.
     *
     * @param task объект задачи с обновленными данными.
     * @throws Exception (специализированное исключение) если задача с таким ID не существует.
     */
    void update(Task task) throws Exception;

    /**
     * Удаляет задачу из хранилища по её идентификатору.
     *
     * @param id идентификатор задачи, которую необходимо удалить.
     */
    void deleteById(long id);

    /**
     * Подсчитывает количество "активных" задач для конкретного пользователя.
     * Активной считается задача, находящаяся в статусе OPEN или IN_PROGRESS.
     *
     * @param userId идентификатор пользователя.
     * @return количество активных задач.
     */
    long countActiveTasksByUserId(long userId);
}
